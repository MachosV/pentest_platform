from django.contrib.auth import login
from django.shortcuts import redirect
from django.contrib import messages
from django.contrib.auth.models import User,Group
from django.db.models import Q
from daedalus.models import ManagerProfile

def CreateManager(request):
    username = request.POST['username']
    password = request.POST['password']
    email = request.POST['email']
    user = User.objects.filter(Q(username=username) | Q(email=email))
    if user.exists():
        messages.info(request,'User or email already exists')
        return redirect('Signup')
    else:
        group = Group(name = username)
        group.save()
        user = User(username = username, email = email)
        user.set_password(password)
        user.save()
        group.user_set.add(user)
        userprofile = ManagerProfile(user=user)
        userprofile.save()
        login(request,user)
        return redirect('Dashboard')